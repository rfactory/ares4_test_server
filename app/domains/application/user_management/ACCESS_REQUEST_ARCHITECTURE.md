# `accounts` 도메인: 통합 접근 요청(AccessRequest) 아키텍처

이 문서는 `server2`의 `accounts` 도메인 내에서 '통합 접근 요청(AccessRequest)' 워크플로우를 처리하는 아키텍처를 정의합니다.

---

## 1. 목표

-   **관리자 경험 최적화:** '신규 계정 생성 요청'과 '기존 계정 역할 승격 요청'을 관리자가 **하나의 대기열**에서 일관되게 처리할 수 있도록 합니다.
-   **미래 확장성 확보:** 향후 '기업용 패널'이 도입될 때, 기업 관리자가 자신의 조직과 관련된 요청만 필터링하여 관리할 수 있는 구조를 미리 마련합니다.
-   **아키텍처 단순화:** 두 개의 유사한 모델/워크플로우를 하나로 통합하여 데이터베이스와 백엔드 로직의 복잡성을 줄입니다.

---

## 2. 핵심 설계: UI 분리, 백엔드 통합

사용자의 시나리오에 따라 프론트엔드(UI)의 진입점은 분리하되, 백엔드에서는 이를 하나의 통합된 로직으로 처리합니다.

### 2.1. 프론트엔드 (UI) 흐름

사용자에게는 목적에 따라 명확히 구분된 두 가지 종류의 페이지(또는 링크)를 제공합니다.

-   **페이지 1: 기업 가입 요청 (예: `join_enterprise.html`)**
    -   **목표:** 특정 기업(조직)에 소속되기 위한 요청.
    -   **입력 필드:** 이름, 이메일, 비밀번호, 그리고 소속될 기업을 식별하기 위한 **'사업자등록번호'**.

-   **페이지 2: 시스템 관리자 역할 요청 (예: `request_admin_role.html`)**
    -   **목표:** 시스템의 최상위 관리자(`Prime_Admin` 등) 역할을 요청.
    -   **입력 필드:** 이름, 이메일, 비밀번호. ('사업자등록번호' 필드 없음)

### 2.2. 백엔드 (API) 흐름

-   **단일 엔드포인트:** 프론트엔드의 두 페이지는 모두 **동일한 백엔드 API (`POST /api/v1/accounts/access-requests`)**를 호출합니다.
-   **통합 서비스 로직 (`AccountService`):
    1.  `create_access_request` 서비스는 API로부터 요청 데이터를 전달받습니다.
    2.  전달된 데이터에 **`사업자등록번호`가 포함되어 있는지 확인**합니다.
    3.  **`사업자등록번호`가 있으면:** '기업용 요청'으로 간주하고, 해당 `organization_id`를 찾아 `AccessRequest` 레코드에 함께 저장합니다.
    4.  **`사업자등록번호`가 없으면:** '시스템 관리자용 요청'으로 간주하고, `organization_id` 없이 레코드를 생성합니다.
    5.  두 경우 모두, 신규 사용자는 먼저 비활성 상태의 `User` 계정이 생성된 후, 해당 `user_id`로 `AccessRequest`가 생성됩니다.

이 설계를 통해, 프론트엔드는 사용자에게 명확한 경험을 제공하고, 백엔드는 일관되고 확장성 있는 단일 로직을 유지할 수 있습니다.

---

## 3. 데이터 모델 (`AccessRequest`)

이 아키텍처를 지원하기 위해 다음과 같이 통합되고 단순화된 `AccessRequest` 모델을 사용합니다.

-   `id` (PK)
-   `user_id`: 요청의 대상이 되는 사용자의 ID (NON-nullable, 신규 사용자도 일단 생성 후 연결).
-   `requested_role_id`: 사용자가 요청하는 역할의 ID.
-   `organization_id`: '기업용 요청'일 경우, 대상 조직의 ID (nullable).
-   `status`: 요청의 현재 상태 ('pending', 'approved', 'rejected').
-   `reason`, `reviewed_by_user_id`, `reviewed_at`, `rejection_reason` 등 기타 관리 필드.

> 이 모델은 기존의 `RegistrationRequest`와 `UpgradeRequest`를 대체하며, 더 이상 `request_type`이나 `new_user_info` 같은 필드가 필요 없습니다.
